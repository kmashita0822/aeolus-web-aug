import{j as t}from"./globe-component-CB00IpeK.js";import{r as n}from"./react-vendor-BeLYVh7p.js";const M=()=>{const[c,y]=n.useState([]),[p,v]=n.useState(!0),[h,f]=n.useState(null),[d,m]=n.useState(!1),o="ontouchstart"in window,N="https://www.gdacs.org/gdacsapi/api/events/geteventlist/homepagetable",g=3,w=e=>({TC:"tc",FL:"fl",WF:"wf",DR:"dr",VO:"vo",EQ:"eq"})[e]||"unknown",E=e=>({Green:"green",Orange:"orange",Red:"red"})[e]||"green",j=e=>{if(!e)return"Unknown date";try{const a=new Date(e);return isNaN(a.getTime())?e:a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})+", "+a.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(a){return console.error("Date formatting error:",a),e}},A=e=>{if(typeof e!="string")return"";const a=document.createElement("div");return a.textContent=e,a.innerHTML},x=n.useCallback(async()=>{let e=0;for(;e<g;)try{const a=new AbortController,s=setTimeout(()=>a.abort(),1e4),l=await fetch(N,{signal:a.signal,headers:{Accept:"application/json","User-Agent":"DisasterAlerts/1.0","Cache-Control":"no-cache"}});if(clearTimeout(s),!l.ok)throw new Error(`HTTP error! status: ${l.status} ${l.statusText}`);const i=await l.json();if(!i||!Array.isArray(i))throw new Error("Invalid data format received from API");const r=i.filter(u=>u&&u.eventtype&&u.eventid&&u.eventtype!=="VO"&&u.eventtype!=="EQ");return console.log(`Loaded ${r.length} disaster events (excluding volcanoes and earthquakes)`),r}catch(a){if(e++,console.error(`Fetch attempt ${e} failed:`,a),e>=g)return console.warn("All API attempts failed, showing empty state"),[];await new Promise(s=>setTimeout(s,1e3*e))}return[]},[]);n.useEffect(()=>{(async()=>{const a=performance.now();try{console.log("Loading disaster alerts from GDACS API..."),v(!0),f(null);const s=await x(),l=performance.now()-a;console.log(`Successfully loaded ${s.length} events from API in ${l.toFixed(2)}ms`);const i=s.map(r=>({id:r.eventid,type:w(r.eventtype),level:E(r.alertlevel),title:r.title||"No location available",location:r.title||"Unknown location",time:j(r.eventdate)||r.datestring||"Unknown time",description:r.subtitle||"No detailed description available.",eventId:r.eventid,originalEvent:r}));console.log(`Converted ${i.length} alerts to internal format`),console.log("Sample alert:",i[0]),y(i),v(!1)}catch(s){const l=performance.now()-a;console.error(`Failed to load alerts after ${l.toFixed(2)}ms:`,s),f("Failed to load disaster alerts. Please try again later."),v(!1)}})()},[x]),n.useEffect(()=>{const e=a=>{a.key==="Escape"&&m(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]),n.useEffect(()=>{if(!o)return;const e=a=>{a.target.closest(".modal-container")||m(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[o]),n.useEffect(()=>{console.log("Modal render state:",{isExpanded:d,isTouchDevice:o,alertsCount:c.length,loading:p,error:h})},[d,o,c.length,p,h]);const b=e=>{switch(e){case"tc":return"TROPICAL CYCLONE";case"fl":return"FLOOD";case"wf":return"WILDFIRE";case"dr":return"DROUGHT";case"vo":return"VOLCANO";case"eq":return"EARTHQUAKE";default:return"UNKNOWN"}},L=()=>{o&&m(!d)},T=()=>{o||m(!0)},k=()=>{o||m(!1)},C=()=>{f(null),v(!0),window.location.reload()};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`modal-container ${d?o?"touch-active":"active":""}`,onClick:L,onMouseEnter:T,onMouseLeave:k,tabIndex:0,role:"button","aria-label":"Disaster alerts modal - hover or click to expand","aria-expanded":d,children:[t.jsxs("div",{className:"modal-header",tabIndex:0,role:"button","aria-label":"Modal header - click to expand",children:[t.jsxs("div",{className:"header-content",children:[t.jsx("div",{className:"status-dot","aria-hidden":"true"}),t.jsx("div",{className:"header-title",children:"Disaster Alerts"})]}),t.jsx("div",{className:"event-count","aria-live":"polite","aria-label":"Number of active alerts",children:c.length})]}),t.jsx("div",{className:"modal-content",role:"region","aria-label":"Disaster alerts list",children:t.jsx("div",{className:"content-area",children:p?t.jsxs("div",{className:"loading-container","aria-live":"polite","aria-label":"Loading disaster alerts",children:[t.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),t.jsx("div",{children:"Loading alerts..."})]}):h?t.jsxs("div",{className:"error-state","aria-live":"polite","aria-label":"Error loading disaster alerts",children:[t.jsx("div",{className:"error-icon",children:"⚠️"}),t.jsx("div",{className:"error-title",children:"Failed to Load"}),t.jsx("div",{className:"error-text",children:h}),t.jsx("button",{className:"retry-btn",onClick:C,tabIndex:0,children:"Try Again"})]}):c.length===0?t.jsxs("div",{className:"empty-state","aria-live":"polite","aria-label":"No disaster alerts",children:[t.jsx("div",{className:"empty-icon",children:"🌤️"}),t.jsx("div",{className:"empty-title",children:"No Active Disasters"}),t.jsx("div",{className:"empty-text",children:"There are currently no active natural disaster alerts."})]}):t.jsx("div",{className:"events-list",children:c.map(e=>t.jsxs("div",{className:"event-item",role:"button",tabIndex:0,children:[t.jsxs("div",{className:"event-main-info",children:[t.jsx("div",{className:"event-name",children:A(e.title)}),t.jsx("div",{className:"event-disaster-type",children:b(e.type)})]}),t.jsx("div",{className:"event-timestamp",children:e.time})]},e.id))})})})]})})};export{M as D};
//# sourceMappingURL=disaster-alerts-BYji1bjX.js.map
